name: PR Summary
on:
  pull_request_target:
    types: [opened, synchronize, reopened]
jobs:
  generate-pr-text:
    runs-on: ubuntu-latest
    permissions:
      contents: read
      pull-requests: write
    steps:
      - name: Generate PR Summary
        uses: vblagoje/pr-auto@v1
        id: pr_auto
        with:
          openai_api_key: ${{ secrets.OPENAI_API_KEY }}
          prompt: "Generate a concise bullet-point summary of the pull request changes, grouped by folders (e.g., frontend/, backend/). Include: - Added files and their purpose - Modified files and key updates - Deleted files. Focus only on code and file changes:"
      - name: Add Summary as Comment
        uses: actions/github-script@v7
        with:
          script: |
            const { data: { pr-text } } = ${{ steps.pr_auto.outputs }};
            github.rest.issues.createComment({
              issue_number: context.issue.number,
              owner: context.repo.owner,
              repo: context.repo.repo,
              body: '### PR Summary\n\n' + pr-text
            });
